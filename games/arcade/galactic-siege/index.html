<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Galactic Siege - No Spin Media</title>
  <link rel="stylesheet" href="/style.css">
  <style>
    body { background:#000; color:#fff; margin:0; font-family:Arial,sans-serif; }
    #game-container { display:flex; justify-content:center; padding:20px; gap:30px; flex-wrap:wrap; }
    #game-box { border:2px solid #0f0; box-shadow:0 0 20px #0f0; padding:10px; border-radius:8px; background:#000; position:relative; }
    #game-header { color:#0f0; text-align:center; font-size:1.8em; margin-bottom:5px; text-shadow:0 0 8px #0f0; }
    #game-info { text-align:center; color:#0f0; margin-bottom:10px; font-weight:bold; }
    canvas { background:#000; border:2px solid #0f0; display:block; margin:auto; }
    #sidebar { background:#111; border:2px solid #0f0; box-shadow:0 0 15px #0f0; padding:20px; border-radius:8px; max-width:250px; height:fit-content; }
    #sidebar h2 { color:#0f0; text-align:center; }
    #donate-button { background:#ffd700; color:#000; padding:12px 25px; border:none; border-radius:8px; font-weight:bold; cursor:pointer; margin:10px auto; display:block; }
    #overlay {
      position:absolute; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8);
      color:#0f0; display:flex; flex-direction:column; justify-content:center; align-items:center;
      text-align:center; font-size:2em; font-weight:bold; text-shadow:0 0 8px #0f0; z-index:5;
    }
    .overlay-btn {
      background:#0f0; color:#000; font-weight:bold; padding:0.5rem 1rem; margin-top:1rem;
      border:none; border-radius:6px; cursor:pointer; font-size:1.2rem; box-shadow:0 0 10px #0f0;
    }
    .share-buttons { text-align:center; margin:10px; }
    .share-buttons button {
      padding:6px 12px; margin:0 5px; background:#0073e6; color:#fff;
      border:none; border-radius:4px; cursor:pointer; font-weight:bold;
    }
  </style>
</head>
<body>

  <div id="site-header"></div>
  <script>
    fetch('/header.html')
      .then(r=>r.text())
      .then(h=>document.getElementById('site-header').innerHTML=h);
  </script>

  <div id="game-container">
    <div id="game-box">
      <div id="game-header">Galactic Siege ðŸ‘¾</div>
      <div id="game-info">
        Score: <span id="score">0</span> | Lives: <span id="lives">3</span> | High Score: <span id="highScore">0</span> | Level: <span id="level">1</span>
      </div>

      <div class="share-buttons">
        <button id="shareBtn">ðŸ”— Share with Friends</button>
        <button id="copyBtn">ðŸ“‹ Copy Link</button>
      </div>

      <canvas id="gameCanvas" width="600" height="500"></canvas>

      <div id="overlay">
        <div>Galactic Siege</div>
        <button class="overlay-btn" id="startBtn">Start Game</button>
      </div>
    </div>

    <div id="sidebar">
      <h2>Support Us!</h2>
      <p>If you enjoy ad-free games from No Spin Media, consider supporting us.</p>
      <button id="donate-button" onclick="window.location.href='/sponsor.html'">Donate Now</button>
      <p style="font-size:0.8em; color:#aaa;">Your help keeps No Spin Media alive and growing.</p>
    </div>
  </div>

  <footer style="text-align:center;color:#666;padding:10px;">
    Â© 2025 No Spin Media. Independent. Ad-free. Truth-focused.
  </footer>

  <script>
    const canvas=document.getElementById('gameCanvas');
    const ctx=canvas.getContext('2d');

    let player, bullets=[], aliens=[], alienBullets=[], shields=[];
    let score=0, lives=3, level=1;
    let highScore=localStorage.getItem('galacticSiegeHS')||0;
    let alienDir=1, alienSpeed=0.5;
    let gameRunning=false, nextWaveTimer=0;
    let alienShootTimer = 60; // How often aliens shoot

    const PLAYER_SPEED=6, BULLET_SPEED=7, ALIEN_BULLET_SPEED=3;
    const PLAYER_WIDTH=40, PLAYER_HEIGHT=30;

    const ALIEN_ROWS=3, ALIEN_COLS=8;
    const ALIEN_SIZE=20;

    const SHIELD_BLOCK=5, SHIELD_WIDTH=60, SHIELD_HEIGHT=20;

    function initPlayer(){
      player={x:canvas.width/2-PLAYER_WIDTH/2,y:canvas.height-PLAYER_HEIGHT-10,width:PLAYER_WIDTH,height:PLAYER_HEIGHT,dx:0};
    }

    function createAliens(flyIn=false){
      aliens=[];
      const startX=50, startY=50, spacingX=50, spacingY=40;
      for(let r=0;r<ALIEN_ROWS;r++){
        for(let c=0;c<ALIEN_COLS;c++){
          aliens.push({
            x:startX+c*spacingX,
            y:flyIn ? -60 - (r * spacingY) : r*spacingY+startY, // Start above if flying in
            targetY:r*spacingY+startY,
            width: ALIEN_SIZE, // Add width for collision
            height: ALIEN_SIZE, // Add height for collision
            type:r
          });
        }
      }
    }

    function createShields(){
      shields=[];
      const gap=(canvas.width-(4*SHIELD_WIDTH))/5;
      for(let i=0;i<4;i++){
        const rows=SHIELD_HEIGHT/SHIELD_BLOCK, cols=SHIELD_WIDTH/SHIELD_BLOCK;
        const dmg=Array.from({length:rows},()=>Array(cols).fill(0));
        shields.push({x:gap*(i+1)+i*SHIELD_WIDTH,y:canvas.height-100,width:SHIELD_WIDTH,height:SHIELD_HEIGHT,damage:dmg});
      }
    }

    function drawPlayer(){
      ctx.fillStyle="#fff";
      ctx.beginPath();
      ctx.moveTo(player.x+player.width/2,player.y); // nose
      ctx.lineTo(player.x,player.y+player.height);
      ctx.lineTo(player.x+player.width,player.y+player.height);
      ctx.closePath(); ctx.fill();
      ctx.fillStyle="#00f";
      ctx.fillRect(player.x+player.width/2-5,player.y+10,10,8);
    }

    function drawAlien(a){
      ctx.save();
      ctx.translate(a.x,a.y);
      ctx.fillStyle="#0f0";
      // Alien Type 0 (Crab-like)
      if(a.type===0){
        ctx.fillRect(4,0,12,4);
        ctx.fillRect(2,4,16,4);
        ctx.fillRect(0,8,20,4);
        ctx.fillRect(2,12,16,4);
        ctx.fillRect(4,16,4,4);
        ctx.fillRect(12,16,4,4);
      }
      // Alien Type 1 (Squid-like)
      else if(a.type===1){
        ctx.fillRect(6,0,8,4);
        ctx.fillRect(4,4,12,4);
        ctx.fillRect(2,8,16,4);
        ctx.fillRect(0,12,20,4);
        ctx.fillRect(6,16,2,4);
        ctx.fillRect(12,16,2,4);
      }
      // Alien Type 2 (Bug-like)
      else if(a.type===2){
        ctx.fillRect(6,0,8,4);
        ctx.fillRect(4,4,12,4);
        ctx.fillRect(2,8,16,4);
        ctx.fillRect(0,12,20,4);
        ctx.fillRect(4,16,4,4);
        ctx.fillRect(12,16,4,4);
      }
      ctx.restore();
    }

    function drawShields(){
      shields.forEach(s=>{
        for(let r=0;r<s.damage.length;r++){
          for(let c=0;c<s.damage[r].length;c++){
            if(s.damage[r][c]<3){
              const hp=3-s.damage[r][c]; // 3=full, 2=medium, 1=low
              ctx.fillStyle=hp===3?"#0f0":hp===2?"#ffa500":"#f00"; // Green, Orange, Red
              ctx.fillRect(s.x+c*SHIELD_BLOCK,s.y+r*SHIELD_BLOCK,SHIELD_BLOCK,SHIELD_BLOCK);
            }
          }
        }
      });
    }

    function checkCollision(obj1, obj2){
      return obj1.x < obj2.x + obj2.width &&
             obj1.x + obj1.width > obj2.x &&
             obj1.y < obj2.y + obj2.height &&
             obj1.y + obj1.height > obj2.y;
    }

    function update(){
      ctx.clearRect(0,0,canvas.width,canvas.height);

      if(nextWaveTimer>0){
        ctx.fillStyle="#0f0"; ctx.font="bold 40px Arial"; ctx.textAlign="center";
        ctx.fillText(`Next Wave in ${Math.ceil(nextWaveTimer/60)}`,canvas.width/2,canvas.height/2);
        nextWaveTimer--; requestAnimationFrame(update); return;
      }

      if(!gameRunning){requestAnimationFrame(update); return;}

      // Player movement
      player.x+=player.dx;
      if(player.x<0)player.x=0;
      if(player.x+player.width>canvas.width)player.x=canvas.width-player.width;

      // Draw entities
      drawPlayer();
      aliens.forEach(drawAlien);
      drawShields();

      // Player Bullets
      bullets.forEach((b,i)=>{
        b.y-=BULLET_SPEED;
        ctx.fillStyle="#0ff";
        ctx.fillRect(b.x,b.y,3,10);
        if(b.y<0) bullets.splice(i,1);

        // Bullet collision with aliens
        aliens.forEach((a,j)=>{
          if(checkCollision(b, {x: a.x, y: a.y, width: ALIEN_SIZE, height: ALIEN_SIZE})){
            aliens.splice(j,1);
            bullets.splice(i,1);
            score+=10; updateHUD();
            return; // Exit inner loop as bullet is gone
          }
        });

        // Bullet collision with shields
        shields.forEach(s => {
          for(let r=0; r<s.damage.length; r++) {
            for(let c=0; c<s.damage[r].length; c++) {
              if (s.damage[r][c] < 3) { // Only check if block is not destroyed
                const blockX = s.x + c * SHIELD_BLOCK;
                const blockY = s.y + r * SHIELD_BLOCK;
                if (checkCollision(b, {x: blockX, y: blockY, width: SHIELD_BLOCK, height: SHIELD_BLOCK})) {
                  s.damage[r][c]++; // Damage the block
                  bullets.splice(i,1); // Remove bullet
                  return; // Exit both loops
                }
              }
            }
          }
        });
      });

      // Alien Bullets
      alienBullets.forEach((b, i) => {
        b.y += ALIEN_BULLET_SPEED;
        ctx.fillStyle = "#f00"; // Red for alien bullets
        ctx.fillRect(b.x, b.y, 3, 10);
        if (b.y > canvas.height) alienBullets.splice(i, 1);

        // Alien bullet collision with player
        if (checkCollision(b, player)) {
          alienBullets.splice(i, 1);
          lives--;
          updateHUD();
          if (lives <= 0) gameOver();
          return;
        }

        // Alien bullet collision with shields
        shields.forEach(s => {
          for(let r=0; r<s.damage.length; r++) {
            for(let c=0; c<s.damage[r].length; c++) {
              if (s.damage[r][c] < 3) {
                const blockX = s.x + c * SHIELD_BLOCK;
                const blockY = s.y + r * SHIELD_BLOCK;
                if (checkCollision(b, {x: blockX, y: blockY, width: SHIELD_BLOCK, height: SHIELD_BLOCK})) {
                  s.damage[r][c]++;
                  alienBullets.splice(i, 1);
                  return;
                }
              }
            }
          }
        });
      });

      // Aliens movement and flying in animation
      let edge=false;
      aliens.forEach(a=>{
        if (a.y < a.targetY) { // Animate flying in
          a.y += 1; // Speed of flying in
        } else {
          a.x+=alienDir*alienSpeed;
          if(a.x<0 || a.x+ALIEN_SIZE>canvas.width) edge=true;
        }
      });
      if(edge){
        alienDir*=-1;
        aliens.forEach(a=>a.y+=10);
      }

      // Alien shooting logic
      alienShootTimer--;
      if (alienShootTimer <= 0 && aliens.length > 0) {
        const shootingAlien = aliens[Math.floor(Math.random() * aliens.length)];
        alienBullets.push({x: shootingAlien.x + ALIEN_SIZE / 2, y: shootingAlien.y + ALIEN_SIZE, width:3, height:10});
        alienShootTimer = 60 - (level * 5); // Shoot more often at higher levels
        if (alienShootTimer < 20) alienShootTimer = 20; // Minimum shoot delay
      }

      // Check bottom collision
      aliens.forEach(a=>{
        if(a.y+ALIEN_SIZE>canvas.height-60){ // 60 is buffer above player
          gameOver();
        }
      });

      // Next level
      if(aliens.length===0){
        level++;
        alienSpeed+=0.2;
        nextWaveTimer=180; // 3 sec countdown
        createAliens(true); // New wave flies in
        createShields(); // Reset shields
      }

      requestAnimationFrame(update);
    }

    function updateHUD(){
      document.getElementById('score').innerText=score;
      document.getElementById('lives').innerText=lives;
      document.getElementById('level').innerText=level;
      document.getElementById('highScore').innerText=highScore;
    }

    function startGame(){
      score=0; lives=3; level=1; alienSpeed=0.5; alienShootTimer = 60;
      initPlayer();
      createAliens(true); // Start with aliens flying in
      createShields();
      bullets = []; // Clear any old bullets
      alienBullets = []; // Clear any old alien bullets
      updateHUD(); gameRunning=true;
      document.getElementById('overlay').style.display="none";
    }

    function gameOver(){
      gameRunning=false;
      if(score>highScore){ highScore=score; localStorage.setItem('galacticSiegeHS',highScore); }
      updateHUD();
      const overlay=document.getElementById('overlay');
      overlay.innerHTML=`<div>Game Over</div><button class="overlay-btn" onclick="startGame()">Play Again</button>`;
      overlay.style.display="flex";
    }

    document.addEventListener('keydown',e=>{
      if(e.key==="ArrowLeft") player.dx=-PLAYER_SPEED;
      if(e.key==="ArrowRight") player.dx=PLAYER_SPEED;
      if(e.key===" " && gameRunning){ // Only allow shooting if game is running
        bullets.push({x:player.x+player.width/2-1.5,y:player.y, width:3, height:10}); // Adjust x for bullet center
      }
    });
    document.addEventListener('keyup',e=>{
      if(e.key==="ArrowLeft"||e.key==="ArrowRight") player.dx=0;
    });

    document.getElementById('startBtn').onclick=startGame;

    document.getElementById('shareBtn').onclick=()=>{navigator.share?navigator.share({title:"Galactic Siege",url:location.href}):navigator.clipboard.writeText(location.href).then(()=>alert("Link copied"));};
    document.getElementById('copyBtn').onclick=()=>{navigator.clipboard.writeText(location.href).then(()=>alert("Link copied"));};

    initPlayer(); createShields(); updateHUD(); update();
  </script>
</body>
</html>
