async function loadStories() {
    const apiURL = "https://data.nospin.media/unpublished";
    const response = await fetch(apiURL);
    let stories = await response.json();

    // Posting slots (EST)
    const slots = [
        "00:30", "06:15", "08:45", "10:15", "11:45",
        "13:15", "15:45", "17:15", "18:30", "20:45"
    ];

    // Convert slot string to a Date object (EST)
    function nextSlotFrom(now) {
        const est = new Date(now.toLocaleString("en-US", { timeZone: "America/New_York" }));
        const today = est.toISOString().split("T")[0];

        for (let s of slots) {
            const dt = new Date(`${today}T${s}:00-05:00`);
            if (dt > est) return dt;
        }

        // If all slots passed, return tomorrow's first slot
        const tomorrow = new Date(est.getTime() + 24 * 60 * 60 * 1000);
        const tStr = tomorrow.toISOString().split("T")[0];
        return new Date(`${tStr}T${slots[0]}:00-05:00`);
    }

    // Assign schedule times to each story
    let currentSlot = nextSlotFrom(new Date());

    for (let i = 0; i < stories.length; i++) {
        stories[i].scheduled = currentSlot.toISOString();

        // Advance to next slot
        const estDate = new Date(currentSlot.toLocaleString("en-US", { timeZone: "America/New_York" }));
        let slotIndex = slots.indexOf(
            estDate.toISOString().substring(11,16)
        );

        slotIndex++;
        if (slotIndex >= slots.length) {
            // Move to tomorrow at slot 0
            const tomorrow = new Date(estDate.getTime() + 24 * 60 * 60 * 1000);
            const tStr = tomorrow.toISOString().split("T")[0];
            currentSlot = new Date(`${tStr}T${slots[0]}:00-05:00`);
        } else {
            const tStr = estDate.toISOString().split("T")[0];
            currentSlot = new Date(`${tStr}T${slots[slotIndex]}:00-05:00`);
        }
    }

    // Group stories by scheduled date
    const groups = {};
    stories.forEach(r => {
        const d = r.scheduled.split("T")[0];
        if (!groups[d]) groups[d] = [];
        groups[d].push(r);
    });

    // Render
    const container = document.getElementById("stories-container");
    container.innerHTML = "";

    const months = ["January","February","March","April","May","June","July","August","September","October","November","December"];
    const weekdays = ["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];

    for (const date in groups) {
        const dt = new Date(date + "T00:00:00");
        const label =
            `${weekdays[dt.getDay()]}, ${months[dt.getMonth()]} ${dt.getDate()}, ${dt.getFullYear()}`;

        let dateGroup = document.createElement("div");
        dateGroup.className = "date-group";
        dateGroup.innerHTML = `<div class="date-header">${label}</div>`;

        groups[date].forEach(story => {
            const sched = new Date(story.scheduled);
            const timeLabel = sched.toLocaleTimeString("en-US", { timeZone: "America/New_York", hour: "numeric", minute: "2-digit" });

            const card = document.createElement("div");
            card.className = "story-card";
            card.innerHTML = `
                <h3>${story.headline}</h3>
                <div class="bias">Scheduled: <strong>${timeLabel} EST</strong></div>
                <div class="bias">Bias: ${story.bias}</div>
                <button class="toggle" onclick="toggleSummary(this)">Show Story</button>
                <div class="summary">${story.summary}</div>
            `;
            dateGroup.appendChild(card);
        });

        container.appendChild(dateGroup);
    }
}
