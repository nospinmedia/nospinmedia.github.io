<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Install the Tip Calculator | No Spin Media</title>
  <link rel="stylesheet" href="../style.css" />
  <style>
    body{
      font-family: Arial, sans-serif;
      margin:0; padding:0; color:#222; background:#f4f4f4;
      padding-top:70px; /* match fixed header height */
      line-height:1.55;
    }
    .wrap{max-width:820px;margin:1.25rem auto;padding:0 1rem}
    .card{background:#fff;border-radius:14px;box-shadow:0 2px 10px rgba(0,0,0,.06);padding:1.2rem;margin-bottom:1rem}
    h1{margin:.25rem 0 0;font-size:1.35rem}
    h2{margin:0 0 .5rem;font-size:1.1rem}
    ol{margin:.35rem 0 0 1.2rem}
    .tip{font-size:.95rem;color:#666;margin-top:.6rem}
    .badge{display:inline-block;background:#eef;border-radius:999px;padding:.25rem .6rem;font-size:.85rem;color:#223}
    .cta{display:inline-block;border:1px solid #ccc;border-radius:10px;padding:.6rem .9rem;font-weight:600;text-decoration:none;color:#222;margin-top:.5rem}
    .cta.primary{border-color:#111;background:#111;color:#fff}
    .hide{display:none}
    .row{display:flex;gap:1rem;flex-wrap:wrap}
    .row .card{flex:1 1 300px}
    .foot{font-size:.9rem;color:#666;margin:1rem 0}
    .list ul{margin:.35rem 0 0 1.1rem}
  </style>
</head>
<body>

  <!-- Shared header gets injected here -->
  <div id="site-header"></div>

  <div class="wrap">
    <div class="card">
      <h1>Install the Tip Calculator</h1>
      <div class="tip">Optional, fast, and works offline. Nothing changes unless you tap “Install”.</div>
    </div>

    <div id="notice" class="card hide"></div>

    <div class="row">
      <!-- iPhone / iPad -->
      <section id="ios" class="card hide">
        <h2>For iPhone / iPad (Safari)</h2>
        <div class="badge">Manual steps (Apple requires Safari)</div>
        <ol>
          <li>Open <strong>Safari</strong> on your iPhone or iPad.</li>
          <li>Go to <strong>nospin.media/tip</strong>.</li>
          <li>Tap the <strong>Share</strong> button (square with ↑).</li>
          <li>Choose <strong>Add to Home Screen</strong>.</li>
          <li>Tap <strong>Add</strong>.</li>
        </ol>
        <p class="tip">If you’re in another browser, first open this page in Safari, then follow the steps.</p>
        <a id="openSafari" class="cta" href="#">Open in Safari</a>
      </section>

      <!-- Android -->
      <section id="android" class="card hide">
        <h2>For Android</h2>
        <div class="badge">One‑tap prompt in Chrome/Edge</div>
        <ol>
          <li>Open <strong>Chrome</strong> on your phone.</li>
          <li>Go to <strong>nospin.media/tip</strong>.</li>
          <li>Tap the <strong>⋮ menu</strong> (three dots, top‑right).</li>
          <li>Choose <strong>Install app</strong> (or <strong>Add to Home Screen</strong>).</li>
          <li>Confirm to add it.</li>
        </ol>
        <button id="installBtn" class="cta primary hide">Install App</button>
        <p class="tip">Chrome may also show an install banner at the bottom automatically. If not, the ⋮ menu option above always works.</p>
      </section>
    </div>

    <div class="card list">
      <h2>What happens when you install?</h2>
      <ul>
        <li>It appears on your home screen like an app.</li>
        <li>Opens full‑screen and works offline (email receipts send when back online).</li>
        <li>Nothing sneaky—this is 100% optional and user‑initiated.</li>
      </ul>
      <a class="cta" href="tip.html">Open the Tip Calculator</a>
    </div>

    <div class="foot">Guide v1.3 • This page won’t change your device without your action.</div>
  </div>

  <script>
    // Inject shared header and wire hamburger exactly like your utilities index
    document.addEventListener('DOMContentLoaded', async function () {
      try {
        const res = await fetch('../header.html');
        const html = await res.text();
        document.getElementById('site-header').innerHTML = html;

        const hamburger = document.getElementById('hamburger');
        const mobileNav = document.getElementById('mobile-nav');

        if (hamburger && mobileNav) {
          function toggleMobileNav() {
            mobileNav.classList.toggle('open');
            hamburger.classList.toggle('active');
          }
          hamburger.addEventListener('click', toggleMobileNav);
          hamburger.addEventListener('touchstart', function (e) {
            e.preventDefault();
            toggleMobileNav();
          }, { passive: false });

          mobileNav.querySelectorAll('a').forEach(link => {
            link.addEventListener('click', () => {
              mobileNav.classList.remove('open');
              hamburger.classList.remove('active');
            });
          });

          // ✅ Auto‑open hamburger on phone view
          if (window.matchMedia('(max-width: 768px)').matches) {
            mobileNav.classList.add('open');
            hamburger.classList.add('active');
          }
        }
      } catch (e) {
        console.error('Header load failed:', e);
      }
    });

    // ---- Device/browser detection + Android install prompt ----
    (function(){
      const ua = navigator.userAgent || "";
      const isIOS = /iPad|iPhone|iPod/.test(ua) || (navigator.platform === 'MacIntel' && navigator.maxTouchPoints > 1);
      const isSafari = /^((?!chrome|android).)*safari/i.test(ua);
      const isAndroid = /Android/i.test(ua);
      const isChromeLike = /Chrome\/|CriOS\//.test(ua);

      const notice = document.getElementById("notice");
      const iosBox = document.getElementById("ios");
      const androidBox = document.getElementById("android");
      const installBtn = document.getElementById("installBtn");
      const openSafari = document.getElementById("openSafari");

      if (isIOS){
        iosBox.classList.remove("hide");
        if (!isSafari){
          notice.classList.remove("hide");
          notice.innerHTML = `
            <div style="display:flex;align-items:center;gap:.5rem">
              <strong>Heads up:</strong>
              <span>On iPhone, Apple only allows “Add to Home Screen” in <em>Safari</em>.</span>
            </div>`;
        }
      } else if (isAndroid){
        androidBox.classList.remove("hide");
      } else {
        iosBox.classList.remove("hide");
        androidBox.classList.remove("hide");
      }

      // Open this page in Safari (best‑effort; still user‑initiated)
      openSafari?.addEventListener("click", (e)=>{
        e.preventDefault();
        const url = location.href.replace(/^http:/, "https:");
        location.href = url;
      });

      // Show Android "Install App" button when allowed
      let deferredPrompt = null;
      window.addEventListener("beforeinstallprompt", (e) => {
        if (isAndroid && isChromeLike){
          e.preventDefault();
          deferredPrompt = e;
          installBtn?.classList.remove("hide");
        }
      });

      installBtn?.addEventListener("click", async ()=>{
        if (!deferredPrompt) return;
        deferredPrompt.prompt();
        await deferredPrompt.userChoice;
        deferredPrompt = null;
        installBtn.classList.add("hide");
      });
    })();
  </script>
</body>
</html>
