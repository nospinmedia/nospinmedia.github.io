<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tip Calculator | No Spin Utilities</title>
  <link rel="stylesheet" href="../style.css">
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      background: #f4f4f4;
      color: #222;
      padding-top: 70px;
    }
    .container {
      display: flex;
      flex-wrap: wrap;
      padding: 2rem;
      max-width: 1200px;
      margin: 0 auto;
      gap: 2rem;
    }
    .main {
      flex: 1 1 60%;
      background: #fff;
      border-radius: 8px;
      padding: 1.5rem;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    }
    .sidebar {
      flex: 1 1 30%;
      background: #fff;
      border-radius: 8px;
      padding: 1.5rem;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
      align-self: flex-start;
    }
    h1 { font-size: 2rem; margin-top: 0; }
    .input-row { display: flex; gap: 1rem; }
    .input-col { flex: 1; }
    label { font-weight: bold; margin-top: 0.6rem; display: block; }
    input[type="number"], input[type="email"] {
      width: 100%;
      padding: 8px;
      margin-top: 4px;
      border: 1px solid #ccc;
      border-radius: 4px;
      font-size: 16px;
    }
    .checkbox-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 0.3rem 0.5rem;
      margin-top: 0.8rem;
    }
    .checkbox-grid label {
      font-weight: normal;
      display: flex;
      align-items: center;
    }
    .button-row { display: flex; gap: 0.5rem; margin-top: 1rem; }
    .adjust-buttons { display: flex; gap: 0.5rem; margin-top: 0.5rem; }
    .adjust-buttons button { flex: 1; padding: 6px; font-size: 0.9rem; }
    button {
      background: #0073e6;
      color: #fff;
      border: none;
      padding: 10px;
      width: 100%;
      font-weight: bold;
      border-radius: 4px;
      cursor: pointer;
    }
    button:hover { background: #005bb5; }
    .clear-btn { background: #d9534f; color: white; }
    .clear-btn:hover { background: #b52b27; }
    .result {
      margin-top: 1rem;
      font-size: 1.1rem;
      background: #f9f9f9;
      padding: 0.8rem;
      border-radius: 6px;
      border: 1px solid #ddd;
      white-space: pre-line;
    }
    #randomMessage {
      text-align: center;
      font-size: 0.9rem;
      margin-top: 0.5rem;
      color: #666;
    }
    @media (max-width: 768px) {
      .container { flex-direction: column; }
    }
  </style>
</head>
<body>
  <div id="site-header"></div>

  <div class="container">
    <div class="main">
      <h1>üí∞ Tip Calculator</h1>
      <p>Quickly calculate tips with rounding options, manual overrides, and optional email receipts.</p>

      <div class="input-row">
        <div class="input-col">
          <label>Bill Total:</label>
          <input type="number" id="billTotal" placeholder="Enter total">
        </div>
        <div class="input-col">
          <label>Tax Total:</label>
          <input type="number" id="taxTotal" placeholder="Optional">
        </div>
      </div>

      <div class="input-row">
        <div class="input-col">
          <label>Tip %:</label>
          <input type="number" id="tipPercent" value="20">
        </div>
        <div class="input-col">
          <label>Manual Tip:</label>
          <input type="number" id="manualTip" placeholder="Optional">
        </div>
      </div>

      <div class="checkbox-grid">
        <label><input type="checkbox" id="roundUp"> Round Up</label>
        <label><input type="checkbox" id="roundDown"> Round Down</label>
        <label><input type="checkbox" id="exactPercent"> Exact %</label>
        <label><input type="checkbox" id="emailReceipt"> Email Receipt</label>
        <label><input type="checkbox" id="excludeTax"> Exclude Tax</label>
      </div>

      <label>Your Email:</label>
      <input type="email" id="userEmail" placeholder="you@email.com">

      <div class="button-row">
        <button onclick="calculateTip()">Calculate Tip</button>
        <button onclick="completeTip()">‚úÖ Complete & Email</button>
      </div>

      <div class="adjust-buttons">
        <button onclick="adjustTotal(0.5)">+ $0.50</button>
        <button onclick="adjustTotal(-0.5)">- $0.50</button>
        <button class="clear-btn" onclick="clearFields()">Clear</button>
      </div>

      <div class="result" id="result"></div>
      <div id="emailStatus" style="margin-top:6px;color:green;font-weight:bold;"></div>

      <div class="button-row" style="margin-top:1rem;">
        <button onclick="copyLink()">üìã Copy Link</button>
        <button onclick="shareFriends()">üîó Share with Friends</button>
      </div>

      <div id="randomMessage"></div>
      <div style="text-align:center;font-size:0.8rem;color:#999;margin-top:0.5rem;">v2.4</div>
    </div>

    <div class="sidebar">
      <h2>Support Our Utilities üíô</h2>
      <p>Like these tools? Help keep No Spin Utilities running:</p>
      <p><strong>Venmo:</strong><br/>
        <a href="https://venmo.com/NoSpinMedia" target="_blank">@NoSpinMedia</a>
      </p>
      <h2>Follow Us</h2>
      <p>üìò <a href="https://facebook.com/NoSpinNewsAI" target="_blank">facebook.com/NoSpinNewsAI</a></p>
      <h2>We ‚ù§Ô∏è Your Feedback!</h2>
      <p>Have an idea for improving this tool? We read every suggestion. üòä</p>
      <p>You can also reach us at: <strong>nospinmedia.ai@gmail.com</strong></p>
      <form id="feedbackForm">
        <input type="text" id="name" name="name" placeholder="Your first name">
        <input type="email" id="email" name="email" placeholder="you@email.com" required>
        <textarea id="message" name="message" rows="4" placeholder="Your feedback..." required></textarea>
        <p id="formStatus"></p>
        <button type="submit">üí¨ Send Feedback</button>
      </form>
    </div>
  </div>

  <footer>
    <div style="text-align:center;">
      ¬© 2025 No Spin Media. Independent. Truth-focused.<br>Seriously factual, surprisingly fun.
    </div>
  </footer>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      fetch('../header.html')
        .then(res => res.text())
        .then(html => document.getElementById('site-header').innerHTML = html);
    });

    function calculateValues() {
      const total = parseFloat(document.getElementById('billTotal').value) || 0;
      const taxInput = document.getElementById('taxTotal').value.trim();
      const tax = taxInput === "" ? null : parseFloat(taxInput) || 0;
      const percent = parseFloat(document.getElementById('tipPercent').value) || 20;
      const manualTip = parseFloat(document.getElementById('manualTip').value);
      const excludeTax = document.getElementById('excludeTax').checked;
      const base = (excludeTax && tax !== null) ? total - tax : total;

      let tip = !isNaN(manualTip) ? manualTip : base * (percent / 100);
      const roundUp = document.getElementById('roundUp').checked;
      const roundDown = document.getElementById('roundDown').checked;
      let finalTotal = total + tip;

      if (roundUp) finalTotal = Math.ceil(finalTotal);
      if (roundDown) finalTotal = Math.floor(finalTotal);
      if (roundUp || roundDown) tip = finalTotal - total;

      const simplePercent = Math.round((tip / base) * 100);
      const exactPercent = (tip / base) * 100;

      let taxPercent = null;
      if (tax !== null && total > 0) {
        const mealCost = total - tax;
        taxPercent = (tax / mealCost) * 100;
      }

      return { total, tax, tip, finalTotal, simplePercent, exactPercent, taxPercent };
    }

    function calculateTip() {
      const { total, tax, tip, finalTotal, simplePercent, exactPercent, taxPercent } = calculateValues();

      let resultText = "";
      if (tax !== null) {
        const mealCost = (total - tax).toFixed(2);
        resultText += `Meal Cost (Pre-Tax): $${mealCost}\n`;
        resultText += `Tax: $${tax.toFixed(2)}${taxPercent ? ` (You paid ${taxPercent.toFixed(2)}% in tax)` : ""}\n`;
        resultText += `Bill Total: $${total.toFixed(2)}\n`;
      } else {
        resultText += `Bill Total: $${total.toFixed(2)}\n`;
      }
      resultText += `Tip: $${tip.toFixed(2)} (${simplePercent}% - Exact: ${exactPercent.toFixed(2)}%)\n\n`;
      resultText += `Total with Tip: $${finalTotal.toFixed(2)}`;

      document.getElementById('result').textContent = resultText;
      document.getElementById('emailStatus').textContent = "";
      setRandomMessage();
    }

    async function completeTip() {
      const { total, tax, tip, finalTotal, simplePercent, exactPercent, taxPercent } = calculateValues();
      calculateTip();

      if (!document.getElementById('emailReceipt').checked) return;
      const email = document.getElementById('userEmail').value.trim();
      if (!email) {
        document.getElementById('emailStatus').textContent = "‚ùå Enter your email to receive receipt.";
        return;
      }

      let message = "";
      if (tax !== null) {
        const mealCost = (total - tax).toFixed(2);
        message += `Meal Cost (Pre-Tax): $${mealCost}\n`;
        message += `Tax: $${tax.toFixed(2)}${taxPercent ? ` (You paid ${taxPercent.toFixed(2)}% in tax)` : ""}\n`;
        message += `Bill Total: $${total.toFixed(2)}\n`;
      } else {
        message += `Bill Total: $${total.toFixed(2)}\n`;
      }
      message += `Tip: $${tip.toFixed(2)} (${simplePercent}% - Exact: ${exactPercent.toFixed(2)}%)\n\n`;
      message += `Total with Tip: $${finalTotal.toFixed(2)}\n\n`;
      message += `Check out our other utilities:\nhttps://nospin.media/utilities/index.html\n\n`;
      message += getRandomClosing();

      const data = {
        name: "No Spin Utilities",
        email: email,
        subject: "Your Tip Calculator Receipt",
        message: message
      };

      try {
        await fetch('https://script.google.com/macros/s/AKfycbwRMD0KhGcv8YGo-GFw2onU5PYldc19J50uGCqRuxbA2wSTj2y8uNZaBnp-DrbHr_rNjQ/exec', {
          method: 'POST',
          headers: {'Content-Type':'text/plain'},
          body: JSON.stringify(data)
        });
        document.getElementById('emailStatus').textContent = "‚úÖ Receipt sent to " + email;
      } catch (err) {
        document.getElementById('emailStatus').textContent = "‚ùå Failed to send email.";
      }
    }

    function adjustTotal(amount) {
      const billField = document.getElementById('billTotal');
      const current = parseFloat(billField.value) || 0;
      billField.value = (current + amount).toFixed(2);
      calculateTip();
    }

    function clearFields() {
      document.getElementById('billTotal').value = "";
      document.getElementById('taxTotal').value = "";
      document.getElementById('manualTip').value = "";
      document.getElementById('result').textContent = "";
      document.getElementById('emailStatus').textContent = "";
    }

    function copyLink() {
      navigator.clipboard.writeText(window.location.href);
      alert("Link copied to clipboard!");
    }

    function shareFriends() {
      if (navigator.share) {
        navigator.share({
          title: "Tip Calculator",
          text: "Check out this handy Tip Calculator!",
          url: window.location.href
        });
      } else {
        alert("Sharing not supported on this device.");
      }
    }

    function setRandomMessage() {
      const messages = [
        "A little math, a lot of gratitude!",
        "Thanks for using our Tip Calculator!",
        "Sharing is caring ‚Äì spread the tool!",
        "Smart tips make happy wallets!",
        "We appreciate you using No Spin Utilities!"
      ];
      const msg = messages[Math.floor(Math.random() * messages.length)];
      document.getElementById('randomMessage').textContent = msg;
    }

    function getRandomClosing() {
      const closings = [
        "A little math, a lot of gratitude!",
        "Thanks for using our Tip Calculator!",
        "Your wallet thanks you for the smart tip!",
        "Sharing is caring ‚Äì spread the tool!",
        "We appreciate you using No Spin Utilities!"
      ];
      return closings[Math.floor(Math.random() * closings.length)];
    }
  </script>
</body>
</html>
