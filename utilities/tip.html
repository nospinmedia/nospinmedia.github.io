<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tip Calculator | No Spin Utilities</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* Custom CSS to handle the mobile navigation menu */
    .mobile-nav {
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.3s ease-out;
    }
    .mobile-nav.open {
      max-height: 500px; /* Adjust to a value larger than the menu's height */
      transition: max-height 0.5s ease-in;
    }
    .hamburger span {
      display: block;
      width: 25px;
      height: 3px;
      margin-bottom: 5px;
      background-color: white;
      transition: all 0.3s ease;
    }
    .hamburger.active span:nth-child(2) {
      opacity: 0;
    }
    .hamburger.active span:nth-child(1) {
      transform: translateY(8px) rotate(45deg);
    }
    .hamburger.active span:nth-child(3) {
      transform: translateY(-8px) rotate(-45deg);
    }
    body {
      font-family: 'Inter', sans-serif;
    }
  </style>
</head>
<body class="bg-gray-100 text-gray-800">

  <!-- This div is where the header will be dynamically loaded -->
  <div id="site-header"></div>

  <div class="container mx-auto flex flex-wrap p-8 max-w-7xl gap-8">
    <div class="flex-1 bg-white rounded-lg p-6 shadow-md md:w-3/5">
      <h1 class="text-3xl font-bold mt-0">üí∞ Tip Calculator</h1>
      <p class="mt-2 text-gray-600">Quickly calculate tips with rounding options, manual overrides, and optional email receipts.</p>

      <!-- Input Rows -->
      <div class="flex flex-wrap gap-4 mt-4">
        <div class="flex-1">
          <label class="font-bold block mt-2">Bill Total:</label>
          <input type="number" id="billTotal" placeholder="Enter total" class="w-full p-2 mt-1 border border-gray-300 rounded-md text-base">
        </div>
        <div class="flex-1">
          <label class="font-bold block mt-2">Tax Total:</label>
          <input type="number" id="taxTotal" placeholder="Optional" class="w-full p-2 mt-1 border border-gray-300 rounded-md text-base">
        </div>
      </div>

      <div class="flex flex-wrap gap-4 mt-4">
        <div class="flex-1">
          <label class="font-bold block mt-2">Tip %:</label>
          <input type="number" id="tipPercent" value="20" class="w-full p-2 mt-1 border border-gray-300 rounded-md text-base">
        </div>
        <div class="flex-1">
          <label class="font-bold block mt-2">Manual Tip:</label>
          <input type="number" id="manualTip" placeholder="Optional" class="w-full p-2 mt-1 border border-gray-300 rounded-md text-base">
        </div>
      </div>

      <!-- Checkbox Grid -->
      <div class="grid grid-cols-2 gap-x-4 gap-y-1 mt-4">
        <label class="font-normal flex items-center whitespace-nowrap"><input type="checkbox" id="roundUp" class="mr-2"> Round Up</label>
        <label class="font-normal flex items-center whitespace-nowrap"><input type="checkbox" id="roundDown" class="mr-2"> Round Down</label>
        <label class="font-normal flex items-center whitespace-nowrap"><input type="checkbox" id="exactPercent" class="mr-2"> Exact %</label>
        <label class="font-normal flex items-center whitespace-nowrap"><input type="checkbox" id="excludeTax" class="mr-2"> Exclude Tax</label>
      </div>

      <label class="font-bold block mt-2">Your Email:</label>
      <input type="email" id="userEmail" placeholder="Enter email here to receive a receipt" class="w-full p-2 mt-1 border border-gray-300 rounded-md text-base">

      <!-- Action Buttons -->
      <div class="flex gap-2 mt-4">
        <button class="flex-1 bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-md cursor-pointer" onclick="calculateTip()">Calculate Tip</button>
        <button class="flex-1 bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-md cursor-pointer" onclick="completeTip()">‚úÖ Complete & Email</button>
      </div>

      <div class="flex gap-2 mt-2">
        <button class="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-800 font-bold py-2 px-4 rounded-md cursor-pointer" onclick="adjustTotal(0.5)">+ $0.50</button>
        <button class="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-800 font-bold py-2 px-4 rounded-md cursor-pointer" onclick="adjustTotal(-0.5)">- $0.50</button>
        <button class="flex-1 bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded-md cursor-pointer" onclick="clearFields()">Clear</button>
      </div>

      <!-- Results and Status -->
      <div class="mt-4 text-lg bg-gray-50 p-3 rounded-md border border-gray-200" id="result"></div>
      <div id="emailStatus" class="mt-2 text-green-600 font-bold"></div>

      <!-- Share Buttons -->
      <div class="flex gap-2 mt-2">
        <button class="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-800 font-bold py-2 px-4 rounded-md cursor-pointer" onclick="copyLink()">üìã Copy Link</button>
        <button class="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-800 font-bold py-2 px-4 rounded-md cursor-pointer" onclick="shareFriends()">üîó Share with Friends</button>
      </div>

      <!-- Footer -->
      <footer class="text-center mt-4 text-sm text-gray-500">¬© 2025 No Spin Media. Independent. Truth-focused.<br>Seriously factual, surprisingly fun.<br><span class="text-xs text-gray-400">v3.5</span></footer>
    </div>

    <!-- Sidebar -->
    <div class="flex-1 bg-white rounded-lg p-6 shadow-md md:w-2/5 md:self-start">
      <h2 class="text-2xl font-bold">Support Our Utilities üíô</h2>
      <p class="mt-2 text-gray-600">Like these tools? Help keep No Spin Utilities running:</p>
      <p class="mt-4 font-bold">Venmo:<br/><a href="https://venmo.com/NoSpinMedia" target="_blank" class="text-blue-600 hover:underline">@NoSpinMedia</a></p>

      <h2 class="text-2xl font-bold mt-6">We ‚ù§Ô∏è Your Feedback!</h2>
      <p class="mt-2 text-gray-600">Have an idea for improving this tool? We read every suggestion. üôÇ</p>
      <p class="mt-4 font-bold">You can also reach us at:<br/><a href="mailto:nospinmedia.ai@gmail.com" class="text-blue-600 hover:underline">nospinmedia.ai@gmail.com</a></p>

      <form id="feedbackForm" class="flex flex-col space-y-2 mt-2">
        <input type="text" id="name" name="name" placeholder="Your first name" class="p-2 border border-gray-300 rounded-md">
        <input type="email" id="email" name="email" placeholder="you@email.com" required class="p-2 border border-gray-300 rounded-md">
        <textarea id="message" name="message" rows="4" placeholder="Your feedback..." required class="p-2 border border-gray-300 rounded-md"></textarea>
        <p id="formStatus" class="text-sm font-semibold"></p>
        <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-md cursor-pointer">üí¨ Send Feedback</button>
      </form>
    </div>
  </div>

  <script>
    // ‚úÖ This is a mock header.html content to make the app self-contained.
    const headerHtml = `
      <header class="fixed top-0 left-0 w-full bg-black text-white shadow-md z-50 p-4">
        <div class="container mx-auto flex items-center justify-between">
          <div class="flex items-center space-x-2">
            <!-- Logo/Icon -->
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-6 h-6 text-blue-600">
              <path d="M11.666 2.05a.75.75 0 0 1 .668 0l7.25 3.625a.75.75 0 0 1 .424.678v8.625a.75.75 0 0 1-.424.678l-7.25 3.625a.75.75 0 0 1-.668 0l-7.25-3.625A.75.75 0 0 1 3 14.978V6.353a.75.75 0 0 1 .424-.678l7.25-3.625ZM12 4.103 6.253 7.042 12 9.982l5.747-2.94L12 4.103ZM4.5 7.777l6 3v4.364l-6-3V7.777Zm7.5 7.644V12.72l5.999-3v4.364l-5.999 3Z" />
            </svg>
            <h2 class="text-xl font-bold text-white">No Spin Utilities</h2>
          </div>
          <!-- Desktop Navigation Links -->
          <nav class="hidden md:block">
            <ul class="flex space-x-4">
              <li><a href="#" class="hover:text-blue-300">Home</a></li>
              <li><a href="#" class="hover:text-blue-300">News</a></li>
              <li><a href="#" class="hover:text-blue-300">Emoji Puzzles</a></li>
              <li><a href="#" class="hover:text-blue-300">Emoji Math</a></li>
              <li><a href="#" class="hover:text-blue-300">AI Posts</a></li>
              <li><a href="#" class="hover:text-blue-300">Games</a></li>
              <li><a href="#" class="hover:text-blue-300">Utilities</a></li>
              <li><a href="#" class="hover:text-blue-300">Support</a></li>
              <li><a href="#" class="hover:text-blue-300">Why AI?</a></li>
              <li><a href="#" class="hover:text-blue-300">Facebook</a></li>
            </ul>
          </nav>
          <!-- Hamburger menu for mobile -->
          <div class="md:hidden">
            <button id="hamburger" class="hamburger p-2">
              <span></span>
              <span></span>
              <span></span>
            </button>
          </div>
        </div>
        <!-- Mobile Navigation Menu -->
        <nav id="mobile-nav" class="mobile-nav absolute top-[70px] left-0 w-full bg-black text-white py-4 transition-all duration-300 ease-in-out md:hidden">
          <ul class="flex flex-col items-center space-y-4">
            <li><a href="#" class="block py-2">Home</a></li>
            <li><a href="#" class="block py-2">News</a></li>
            <li><a href="#" class="block py-2">Emoji Puzzles</a></li>
            <li><a href="#" class="block py-2">Emoji Math</a></li>
            <li><a href="#" class="block py-2">AI Posts</a></li>
            <li><a href="#" class="block py-2">Games</a></li>
            <li><a href="#" class="block py-2">Utilities</a></li>
            <li><a href="#" class="block py-2">Support</a></li>
            <li><a href="#" class="block py-2">Why AI?</a></li>
            <li><a href="#" class="block py-2">Facebook</a></li>
          </ul>
        </nav>
      </header>
    `;

    document.addEventListener('DOMContentLoaded', function() {
      // ‚úÖ This is the core logic from your index.html to load the header
      // For this self-contained immersive, we'll use the mock header HTML above.
      // In a real scenario, you would uncomment the fetch call below.
      
      // fetch('header.html')
      //   .then(res => res.text())
      //   .then(html => {
      //     document.getElementById('site-header').innerHTML = html;
      //     initHeaderListeners();
      //   });

      // Instead of a fetch, we'll use the hardcoded string to make the immersive runnable.
      document.getElementById('site-header').innerHTML = headerHtml;
      initHeaderListeners();

      // ‚úÖ Function to initialize event listeners for the header (hamburger menu, etc.)
      function initHeaderListeners() {
        const hamburger = document.getElementById('hamburger');
        const mobileNav = document.getElementById('mobile-nav');

        if (hamburger && mobileNav) {
          const toggleMobileNav = () => {
            mobileNav.classList.toggle('open');
            hamburger.classList.toggle('active');
            // Adjust body padding when mobile nav is open to prevent content jump
            document.body.style.paddingTop = mobileNav.classList.contains('open') ? 'calc(70px + 400px)' : '70px';
          };
          
          hamburger.addEventListener('click', toggleMobileNav);
          hamburger.addEventListener('touchstart', (e) => {
            e.preventDefault();
            toggleMobileNav();
          }, { passive: false });

          mobileNav.querySelectorAll('a').forEach(link => {
            link.addEventListener('click', () => {
              mobileNav.classList.remove('open');
              hamburger.classList.remove('active');
              document.body.style.paddingTop = '70px';
            });
          });
        }
      }

    // ‚úÖ Some of the random upbeat taglines we had earlier:
    const taglines = [
      "üéâ Thanks for using our Tip Calculator! You're keeping math fun.",
      "üôå We appreciate you! Share this tool with friends at your next meal.",
      "üí° Quick, easy, and spin-free! Thanks for supporting No Spin Utilities.",
      "üçΩÔ∏è Bon app√©tit! We hope this helped make splitting the bill painless.",
      "üìä Numbers done right. Spread the word about our handy utilities!",
      "üôè Thank you for trusting No Spin Media with your calculations.",
      "üî• You're a tipping pro now! Share the love (and the math).",
      "üöÄ Fast tips, no hassle. Thanks for stopping by!",
      "üíô Your support helps keep tools like this free and privacy-friendly.",
      "ü§ù Appreciate you! Every user helps No Spin Utilities grow."
    ];

    // ‚úÖ Mutual exclusion for Round Up / Down / Exact %
    const roundUp = document.getElementById('roundUp');
    const roundDown = document.getElementById('roundDown');
    const exactPercent = document.getElementById('exactPercent');
    [roundUp, roundDown, exactPercent].forEach(cb => {
      cb.addEventListener('change', () => {
        if (cb.checked) {
          [roundUp, roundDown, exactPercent].forEach(other => {
            if (other !== cb) other.checked = false;
          });
        }
        saveSettings();
      });
    });

    // ‚úÖ This is the logic to save and load the email and checkbox settings to browser storage.
    // The settings are saved whenever an input changes and loaded when the page loads.
    const userEmail = document.getElementById('userEmail');
    const excludeTax = document.getElementById('excludeTax');
    function saveSettings() {
      const settings = {
        email: userEmail.value,
        roundUp: roundUp.checked,
        roundDown: roundDown.checked,
        exactPercent: exactPercent.checked,
        excludeTax: excludeTax.checked
      };
      localStorage.setItem('tipCalcSettings', JSON.stringify(settings));
    }
    function loadSettings() {
      const saved = JSON.parse(localStorage.getItem('tipCalcSettings') || '{}');
      if (saved.email) userEmail.value = saved.email;
      if (saved.roundUp) roundUp.checked = true;
      if (saved.roundDown) roundDown.checked = true;
      if (saved.exactPercent) exactPercent.checked = true;
      if (saved.excludeTax) excludeTax.checked = true;
    }
    userEmail.addEventListener('input', saveSettings);
    [roundUp, roundDown, exactPercent, excludeTax].forEach(cb => cb.addEventListener('change', saveSettings));
    document.addEventListener('DOMContentLoaded', loadSettings);

    // ‚úÖ Show tax %
    function calculateValues() {
      const total = parseFloat(document.getElementById('billTotal').value) || 0;
      const taxInput = document.getElementById('taxTotal').value.trim();
      const tax = taxInput === "" ? null : parseFloat(taxInput) || 0;
      const percent = parseFloat(document.getElementById('tipPercent').value) || 20;
      const manualTip = parseFloat(document.getElementById('manualTip').value);
      const base = (tax !== null && excludeTax.checked) ? total - tax : total;
      let tip = !isNaN(manualTip) ? manualTip : base * (percent / 100);
      let finalTotal = total + tip;
      if (roundUp.checked) finalTotal = Math.ceil(finalTotal);
      if (roundDown.checked) finalTotal = Math.floor(finalTotal);
      if (roundUp.checked || roundDown.checked) tip = finalTotal - total;
      const taxPercent = (tax !== null && (total - tax) > 0) ? (tax / (total - tax) * 100) : null;
      return { total, tax, base, tip, finalTotal, taxPercent, percent };
    }

    // Function to calculate and display the tip
    function calculateTip() {
      const { total, tax, base, tip, finalTotal, taxPercent, percent } = calculateValues();
      let output = '';
      if (tax !== null) {
        output += `Meal Cost (Pre-Tax): $${(total - tax).toFixed(2)}<br>`;
        output += `Tax: $${tax.toFixed(2)}${taxPercent ? ` (${taxPercent.toFixed(2)}% in tax)` : ''}<br>`;
      }
      
      const exactTipPercent = (base > 0) ? (tip / base) * 100 : 0;
      
      output += `Bill Total: $${total.toFixed(2)}<br>`;
      output += `Tip: $${tip.toFixed(2)} (${percent}% preferred, ${exactTipPercent.toFixed(2)}% actual)<br>`;
      output += `<br><strong>Total with Tip: $${finalTotal.toFixed(2)}</strong>`;
      document.getElementById('result').innerHTML = output;
    }

    // Function to handle the "Complete & Email" action
    function completeTip() {
      const { total, tax, base, tip, finalTotal, taxPercent, percent } = calculateValues();
      const email = userEmail.value.trim();
      if (!email) {
        userEmail.classList.add('border-red-500', 'border-2');
        return;
      }
      userEmail.classList.remove('border-red-500', 'border-2');
      calculateTip();

      let message = '';
      if (tax !== null) {
        message += `Meal Cost (Pre-Tax): $${(total - tax).toFixed(2)}\n`;
        message += `Tax: $${tax.toFixed(2)} (${taxPercent.toFixed(2)}%)\n`;
      }
      
      message += `Bill Total: $${total.toFixed(2)}\n`;
      
      const exactTipPercent = (base > 0) ? (tip / base) * 100 : 0;
      
      message += `Tip: $${tip.toFixed(2)} (${percent}% preferred, ${exactTipPercent.toFixed(2)}% actual)\n`;
      message += `\nTotal with Tip: $${finalTotal.toFixed(2)}\n\n`;
      message += `Your support keeps our tools free & fun!\n\n`;
      message += `Check out our other utilities:\n`;
      message += `https://nospin.media/utilities/index.html\n`;

      const data = { email: email, subject: "Your Tip Calculator Receipt", message: message };
      fetch('https://script.google.com/macros/s/AKfycbwRMD0KhGcv8YGo-GFw2onU5PYldc19J50uGCqRuxbA2wSTj2y8uNZaBnp-DrbHr_rNjQ/exec', {
        method: 'POST', headers: { 'Content-Type': 'text/plain' }, body: JSON.stringify(data)
      }).then(() => document.getElementById('emailStatus').textContent = "‚úÖ Receipt sent to " + email);
    }
    
    // Function to adjust the total by a specific amount
    function adjustTotal(amount) {
      const billTotalInput = document.getElementById('billTotal');
      let currentTotal = parseFloat(billTotalInput.value) || 0;
      currentTotal = (currentTotal + amount);
      billTotalInput.value = currentTotal > 0 ? currentTotal.toFixed(2) : "";
      calculateTip();
    }

    // Function to clear all fields
    function clearFields() {
      document.getElementById('billTotal').value = "";
      document.getElementById('taxTotal').value = "";
      document.getElementById('manualTip').value = "";
      document.getElementById('tipPercent').value = "20";
      document.getElementById('result').innerHTML = "";
      document.getElementById('emailStatus').textContent = "";
      document.getElementById('userEmail').classList.remove('border-red-500', 'border-2');
    }
    
    // Function to copy the link to the clipboard with current values as URL parameters
    function copyLink() {
      const billTotal = document.getElementById('billTotal').value;
      const taxTotal = document.getElementById('taxTotal').value;
      const tipPercent = document.getElementById('tipPercent').value;
      const manualTip = document.getElementById('manualTip').value;
      const roundUp = document.getElementById('roundUp').checked;
      const roundDown = document.getElementById('roundDown').checked;
      const exactPercent = document.getElementById('exactPercent').checked;
      const excludeTax = document.getElementById('excludeTax').checked;

      const params = new URLSearchParams({
        billTotal,
        taxTotal,
        tipPercent,
        manualTip,
        roundUp,
        roundDown,
        exactPercent,
        excludeTax
      });
      const url = `${window.location.href.split('?')[0]}?${params.toString()}`;

      try {
        document.execCommand('copy');
        document.getElementById('emailStatus').textContent = "‚úÖ Link copied to clipboard!";
      } catch (err) {
        // Fallback for browsers that don't support the modern clipboard API
        const tempInput = document.createElement('input');
        tempInput.value = url;
        document.body.appendChild(tempInput);
        tempInput.select();
        document.execCommand('copy');
        document.body.removeChild(tempInput);
        document.getElementById('emailStatus').textContent = "‚úÖ Link copied to clipboard!";
      }
    }
    
    // Function to handle the "Share with Friends" action
    function shareFriends() {
      const billTotal = document.getElementById('billTotal').value;
      const taxTotal = document.getElementById('taxTotal').value;
      const tipPercent = document.getElementById('tipPercent').value;
      const manualTip = document.getElementById('manualTip').value;
      const roundUp = document.getElementById('roundUp').checked;
      const roundDown = document.getElementById('roundDown').checked;
      const exactPercent = document.getElementById('exactPercent').checked;
      const excludeTax = document.getElementById('excludeTax').checked;

      const params = new URLSearchParams({
        billTotal,
        taxTotal,
        tipPercent,
        manualTip,
        roundUp,
        roundDown,
        exactPercent,
        excludeTax
      });
      const url = `${window.location.href.split('?')[0]}?${params.toString()}`;

      const shareData = {
        title: 'Tip Calculator',
        text: 'I just used this great tip calculator from No Spin Utilities. Check it out!',
        url: url,
      };

      if (navigator.share) {
        navigator.share(shareData)
          .then(() => document.getElementById('emailStatus').textContent = "‚úÖ Shared successfully!")
          .catch((error) => console.error('Error sharing:', error));
      } else {
        window.open(`mailto:?subject=${encodeURIComponent(shareData.title)}&body=${encodeURIComponent(shareData.text)}%0A%0A${encodeURIComponent(shareData.url)}`, '_blank');
        document.getElementById('emailStatus').textContent = "‚úÖ Opened email client for sharing.";
      }
    }

    // Feedback form submission handler
    document.getElementById('feedbackForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      const status = document.getElementById('formStatus');
      status.textContent = "‚è≥ Sending...";

      const name = document.getElementById('name').value || "Someone";
      const email = document.getElementById('email').value;
      const message = document.getElementById('message').value;

      const data = {
        name: name,
        email: email,
        subject: "Tip Calculator Feedback",
        message: message
      };

      try {
        const res = await fetch('https://script.google.com/macros/s/AKfycbwr26uY61Dip94_QwzyLh1JDSIFdYHJgqL_scKGLdRd9O42VLDBvt2XzkA67tjphJrs/exec', {
          method: 'POST',
          headers: {'Content-Type':'text/plain'},
          body: JSON.stringify(data)
        });

        let result = {};
        try { result = await res.json(); } catch (err) { result = { status: "success" }; }

        if (result.status === "success") {
          status.textContent = "‚úÖ Thanks! Your feedback was sent.";
          this.reset();
        } else {
          status.textContent = "‚ùå Error sending. Please try again.";
        }
        setTimeout(()=>{ status.textContent = ""; }, 5000);
      } catch (err) {
        console.error(err);
        status.textContent = "‚ùå Failed to send! Check connection.";
        setTimeout(()=>{ status.textContent = ""; }, 5000);
      }
    });

    // Update adjustTotal to ensure two decimal places
    const billTotalInput = document.getElementById('billTotal');
    billTotalInput.addEventListener('change', () => {
        if (billTotalInput.value) {
            billTotalInput.value = parseFloat(billTotalInput.value).toFixed(2);
        }
    });

  });
  </script>
</body>
</html>
